"use strict";(self.webpackChunkcaa_client=self.webpackChunkcaa_client||[]).push([[7319],{47319:function(e,n,t){t.r(n),t.d(n,{default:function(){return F}});var r=t(74165),i=t(15861),s=t(29439),o=t(1413),a=t(53767),l=t(20890),d=t(94721),c=t(36151),u=t(68870),p=t(27391),x=t(68096),h=t(30829),f=t(64415),m=t(81918),g=t(23786),Z=t(94454),b=t(49900),j=t(44695),v=t(61134),y=t(16386),w=t(87376),I=t(763),C=t.n(I),S=t(72791),k=t(85880),M=t(30203),z=t(48367),H=t(29537),V=t(81724),_=t(67142),T=t(94604),L=(t(69043),t(86614)),W=(t(80729),t(10916)),q=t.n(W),A=t(3591),B=t(80184);function E(e){var n=e.setValue,t=e.error,r=e.re_render;return(0,S.useLayoutEffect)((function(){var e=document.createElement("div");document.getElementById("honbun").appendChild(e);var t=L.Z.create(e,{mode:"inline",lang:(0,o.Z)((0,o.Z)({},q()),{},{toolbar:(0,o.Z)((0,o.Z)({},q().toolbar),{},{align:"\u914d\u7f6e"})}),placeholder:"\u672c\u6587\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",display:"block",popupDisplay:"full",defaultStyle:"font-size:16px;padding:0;",tagsBlacklist:"script|link|meta",pasteTagsBlacklist:"script|link|meta",stickyToolbar:"0",plugins:(0,o.Z)({},A.ZP),minHeight:"100px",height:"100%",width:"100%",fontSize:[8,10,12,14,16,18,20,24,36,48],fontSizeUnit:"px",buttonList:[["undo","redo"],["fontSize","align","fontColor","hiliteColor"],["bold","underline","italic"],["link"],["removeFormat"]]});return t.onChange=function(e){n(e)},function(){t.destroy()}}),[r]),(0,B.jsx)(a.Z,{gap:1,sx:{width:"100%","& p":{m:"0 !important"}},children:(0,B.jsxs)(u.Z,{component:"fieldset",sx:{px:2,py:0,borderRadius:1.5,border:"1px solid",borderColor:t?"#f10":"#ccc",color:t?"#f10":"currentColor","& .sun-editor":{border:"none !important"},".sun-editor .se-wrapper .se-placeholder":{padding:0}},children:[(0,B.jsx)(l.Z,{component:"legend",variant:"body2",children:"\u672c\u6587"}),(0,B.jsx)(a.Z,{id:"honbun",sx:{minHeight:100,cursor:"text"}})]})})}var G=t(39709),P=t(21686),R=t(70135),D={PaperProps:{style:{maxHeight:224,width:250}}};function F(){var e=(0,z.CG)((function(e){return e.UI.tokenInfo})),n=(0,z.CG)((function(e){return e.MailHistory.status})),t=(0,z.CG)((function(e){return e.MailHistory.list})),I=(0,S.useMemo)((function(){return t.map((function(e){return(0,o.Z)((0,o.Z)({},e),{},{date:(0,y.Z)(new Date(e.createdAt),"yyyy\u5e74MM\u6708dd\u65e5"),time:(0,y.Z)(new Date(e.createdAt),"HH:mm")})}))}),[t]),L=(0,z.TL)();(0,S.useEffect)((function(){"init"===n&&L((0,H.Q_)())}),[]);var W=(0,z.CG)((function(e){return e.Mailing.status})),q=(0,z.CG)((function(e){return e.Mailing.list}));(0,S.useEffect)((function(){"init"===W&&L((0,R.Tk)())}),[]);var A=(0,S.useState)(),F=(0,s.Z)(A,2),X=F[0],O=F[1],Q=(0,S.useState)(!1),U=(0,s.Z)(Q,2),J=U[0],K=U[1],N=(0,S.useState)(0),Y=(0,s.Z)(N,2),$=Y[0],ee=Y[1],ne=V.Ry({mailingIds:V.IX().required().min(1),subject:V.Z_().required(),text:V.Z_().required(),html:V.Z_().required()}),te=(0,v.cI)({resolver:(0,j.X)(ne),defaultValues:{subject:"",text:"",html:"",mailingIds:[]}}),re=te.register,ie=te.handleSubmit,se=te.reset,oe=te.getValues,ae=te.setValue,le=te.formState.errors;if(!e)return null;var de=C().groupBy(I,"date"),ce=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i,s,o,a,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.html,i=n.mailingIds,s=n.subject,e.prev=1,K(!0),e.next=5,_.l.send({html:t,mailingIds:i.map((function(e){return parseInt(e)})),subject:s});case 5:o=e.sent,a=o.message,l=o.error,L(T.T9.addGlobalMessage({message:a,type:l?"error":"success"})),se(),ee($+1),e.next=15;break;case 13:e.prev=13,e.t0=e.catch(1);case 15:return e.prev=15,K(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[1,13,15,18]])})));return function(n){return e.apply(this,arguments)}}();return(0,B.jsxs)(a.Z,{gap:2,direction:"row",sx:{height:"100%"},children:[(0,B.jsxs)(a.Z,{sx:{width:300,border:"1px solid #eee",borderRadius:1,boxShadow:"1px 2px 10px rgba(0,0,0,0.1)",overflow:"hidden",height:"100%"},children:[(0,B.jsx)(l.Z,{variant:"h6",sx:{bgcolor:function(e){return e.palette.primary.main},color:function(e){return e.palette.primary.contrastText},textAlign:"center",py:1,boxShadow:"0px 2px 4px rgba(0,0,0,0.3)"},children:"\u9001\u4fe1\u5c65\u6b74"}),(0,B.jsx)(a.Z,{gap:2,sx:{flex:1,overflow:"auto",p:.5,boxShadow:"inset 0 0 10px rgba(0,0,0,0.1)"},children:Object.keys(de).map((function(e,n){var t=de[e];return(0,B.jsxs)(a.Z,{children:[(0,B.jsx)(l.Z,{variant:"caption",children:e}),(0,B.jsx)(d.Z,{}),(0,B.jsx)(a.Z,{gap:1,px:.5,children:t.map((function(e){return(0,B.jsxs)(a.Z,{onClick:function(){return O(e)},sx:{p:.5,borderBottom:"1px solid #eee",bgcolor:(null===X||void 0===X?void 0:X.id)===e.id?"#eee":"transparent",cursor:"pointer","&:hover":{bgcolor:"#eee8"}},children:[(0,B.jsx)(l.Z,{sx:{fontWeight:"bold",width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",px:.5},children:e.subject}),(0,B.jsxs)(a.Z,{direction:"row",alignItems:"center",gap:2,justifyContent:"space-between",px:.5,children:[(0,B.jsxs)(l.Z,{variant:"caption",sx:{display:"flex",gap:.5,alignItems:"center"},children:[(0,B.jsx)(k.QJX,{style:{fontSize:14,marginBottom:-2}}),e.organization]}),(0,B.jsxs)(l.Z,{variant:"caption",sx:{display:"flex",gap:.5,alignItems:"center"},children:[(0,B.jsx)(M.Xws,{style:{fontSize:12}}),e.sender]})]}),(0,B.jsx)(a.Z,{direction:"row",alignItems:"center",gap:2,justifyContent:"flex-end",px:.5,children:(0,B.jsxs)(l.Z,{variant:"caption",sx:{fontStyle:"italic",color:"success"===e.status?"#0b1":"#f20"},children:[e.status," at ",e.time]})})]},e.id)}))})]},n)}))}),(0,B.jsx)(d.Z,{}),(0,B.jsx)(a.Z,{px:1,py:2,children:(0,B.jsx)(c.Z,{disabled:!X||e.permissions[w.g.MAIL]<2,variant:"contained",onClick:function(){O(void 0),se()},children:"\u65b0\u3057\u3044\u30e1\u30fc\u30eb"})})]}),(0,B.jsx)(a.Z,{sx:{flex:1,border:"1px solid #eee",borderRadius:1,boxShadow:"1px 2px 10px rgba(0,0,0,0.1)",overflow:"hidden",p:2},children:X?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(a.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",py:.5,children:[(0,B.jsx)(l.Z,{sx:{fontSize:"1.2rem",fontWeight:"bold"},children:X.subject}),(0,B.jsxs)(l.Z,{variant:"caption",children:["\u9001\u4fe1\u6642\u9593\uff1a",(0,y.Z)(new Date(X.createdAt),"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss")]})]}),(0,B.jsxs)(a.Z,{direction:"row",children:[(0,B.jsx)(l.Z,{variant:"body2",children:"\u5b9b\u5148\uff1a "}),(0,B.jsx)(l.Z,{variant:"body2",fontWeight:"bold",children:X.mailing})]}),(0,B.jsxs)(u.Z,{component:"fieldset",sx:{p:1,borderRadius:1.5,border:"1px solid",borderColor:"#ccc",my:1},children:[(0,B.jsx)(l.Z,{component:"legend",variant:"body2",children:"\u672c\u6587"}),(0,B.jsx)(a.Z,{component:"div",dangerouslySetInnerHTML:{__html:X.body}})]}),(0,B.jsx)(a.Z,{justifyContent:"center",alignItems:"center",sx:{height:"3rem",background:function(e){return"success"===X.status?e.palette.success.main:e.palette.error.main}},children:(0,B.jsx)(l.Z,{sx:{color:"#fff",fontSize:20,fontWeight:"bold",textTransform:"capitalize"},children:X.status})})]}):e.permissions[w.g.MAIL]<2?null:(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(l.Z,{variant:"h6",children:"\u30e1\u30fc\u30eb\u9001\u4fe1\u5185\u5bb9\u5165\u529b"}),(0,B.jsx)(d.Z,{}),(0,B.jsxs)(a.Z,{gap:2,component:"form",noValidate:!0,autoComplete:"off",onSubmit:ie(ce),sx:{p:1,my:2,border:"1px solid #eee",borderRadius:1,boxShadow:"1px 2px 10px rgba(0,0,0,0.1)"},children:[(0,B.jsx)(p.Z,(0,o.Z)((0,o.Z)({variant:"outlined",required:!0,margin:"dense",autoFocus:!0,fullWidth:!0,InputLabelProps:{shrink:!0},size:"small",label:"\u4ef6\u540d",placeholder:"\u4ef6\u540d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"},re("subject")),{},{error:"subject"in le})),(0,B.jsxs)(x.Z,{fullWidth:!0,size:"small",required:!0,children:[(0,B.jsx)(h.Z,{children:"\u5b9b\u5148"}),(0,B.jsx)(f.Z,{label:"\u5b9b\u5148",value:oe("mailingIds"),multiple:!0,renderValue:function(e){return(0,B.jsx)(u.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((function(e){var n=q.find((function(n){return n.id===parseInt(e)}));return(0,B.jsx)(m.Z,{label:(null===n||void 0===n?void 0:n.name)||e},e)}))})},MenuProps:D,onChange:function(e){var n=e.target.value;ae("mailingIds","string"===typeof n?n.split(","):n,{shouldValidate:!0})},error:"mailingIds"in le,children:q.map((function(e){return(0,B.jsxs)(g.Z,{value:e.id,children:[(0,B.jsx)(Z.Z,{checked:!!oe("mailingIds").find((function(n){return"".concat(n)==="".concat(e.id)}))}),(0,B.jsx)(b.Z,{primary:e.name})]},e.id)}))})]}),(0,B.jsx)(E,{re_render:$,setValue:function(e){var n=document.createElement("div");n.innerHTML=e;var t=n.textContent||"";ae("text",t,{shouldValidate:!0}),ae("html",e,{shouldValidate:!0})},error:"text"in le}),(0,B.jsx)(u.Z,{children:(0,B.jsx)(G.Z,{variant:"outlined",disabled:Object.keys(le).length>0,loading:J,loadingPosition:"end",endIcon:(0,B.jsx)(P.Z,{}),type:"submit",children:"\u9001\u4fe1\u3059\u308b"})})]})]})})]})}},21686:function(e,n,t){var r=t(64836);n.Z=void 0;var i=r(t(45649)),s=t(80184),o=(0,i.default)((0,s.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");n.Z=o}}]);
//# sourceMappingURL=7319.80426c25.chunk.js.map